<script type='text/javascript' src='https://cdnjs.cloudflare.com/ajax/libs/knockout/3.4.0/knockout-min.js'></script>
<script type='text/javascript' src='https://cdnjs.cloudflare.com/ajax/libs/jquery/3.1.0/jquery.min.js'></script>
<style type="text/css">
<!--
* {
	margin: 0;
	padding: 0;
}
#calendar {
	width: 700px;
}
li {
  padding: 4px;
  width: 90;
  height: 40;
	float: left;
	list-style: none;
  border: 1px solid black;
}
-->
</style>
<input type="text" data-bind="value: koYear, valueUpdate: 'afterkeydown', event: { change: koUpdateCalendar }"></input>
<input type="text" data-bind="value: koMonth, valueUpdate: 'afterkeydown', event: { change: koUpdateCalendar }"></input>
<br>
<div id="calendar">
  <ul>
    <li>mon</li>
    <li>tue</li>
    <li>wed</li>
    <li>thu</li>
    <li>fri</li>
    <li>sat</li>
    <li>sun</li>
    <!-- ko foreach: koDates -->
    <li data-bind="style: { color: $parent.getColor( $data ) }, click: $parent.koClick">
      <div data-bind="text: date"></div>
      <div data-bind="text: $data.schedule?$data.schedule:'none'"></div>
    </li>
    <!-- /ko -->
  </ul>
</div>
<script type='text/javascript' src='../calendar.js'></script>
<script>
  var vm, today = new Date(), model;
  model = {
    init: function( year, month ) {
      this.year = year;
      this.month = month;
      this.data = calendar.createDates( year, month );
    },
    updateCalendar: function( year, month ) {
      this.init( year, month );
    },
    updateSchedule: function( date, schedule ) {
      if ( schedule ) {
        this.data[ this.searchIndex( date ) ].schedule = schedule;
      }
    },
    searchIndex: function( date ) {
      for ( var i in this.data ) {
        if( date.data.toString() === this.data[ i ].data.toString() ) {
          return i;
        }
      }
      return -1;
    },
    getCalendar: function() {
      return this.data;
    }
  };
  model.init( today.getFullYear(), today.getMonth() + 1 );
  vm = {
    koYear: ko.observable( model.year ),
    koMonth: ko.observable( model.month ),
    koDates: ko.observableArray( model.getCalendar() ),
    koUpdateCalendar: function() {
      model.updateCalendar( vm.koYear(), vm.koMonth() );
      vm.koDates( model.getCalendar() );
    },
    getColor: function( date ) {
      if ( date.data.getMonth() + 1 !== parseInt( model.month, 10 ) ) {
        return "gray";
      } else if ( date.data.getDay() === 0 ) { // 日曜
        return "red";
      } else if ( date.data.getDay() === 6 ) {// 土曜
        return "blue";
      }
      return "black";
    },
    koClick: function( date ) {
      var str = window.prompt( "予定を入力" ), tmp, i;
      if ( str ) {
        model.updateSchedule( date, str );
        vm.koDates( [] );
        vm.koDates( model.getCalendar() );
      }
    }
  };
  ko.applyBindings( vm );
</script>
